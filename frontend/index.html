<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>monadmelon@web:~$</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; }
        body { background-color: #0a0a0a; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1; padding: 4px; overflow: hidden; }
        #terminal { height: 100%; overflow-y: auto; white-space: pre-wrap; display: none; }
        #scroll-anchor { height: 1px; }
        .input-line { display: flex; align-items: center; margin-bottom: 2px; }
        .prompt { color: #ff00ff; margin-right: 6px; white-space: nowrap; }
        .command { color: #00ff00; font-weight: bold; }
        .output { margin-bottom: 2px; line-height: 1.2; font-family: 'Courier New', monospace; white-space: pre-wrap; word-break: break-all; }
        #input { background: transparent; border: none; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px; outline: none; width: 100%; padding: 0; margin: 0; }
        .protected { user-select: none; opacity: 0.9; }
        #boot-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0a0a0a; z-index: 1000; padding: 20px; overflow: hidden; }
        .boot-message { margin-bottom: 1px; opacity: 0; animation: typeIn 0.3s forwards; white-space: nowrap; }
        @keyframes typeIn { to { opacity: 1; } }
        .ascii-art-line { margin-bottom: 0; opacity: 0; animation: typeIn 0.2s forwards; white-space: pre; font-family: 'Courier New', monospace; }
        .scanlines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(0, 255, 0, 0.03) 1px, transparent 1px); background-size: 100% 3px; pointer-events: none; animation: scanline 10s linear infinite; }
        @keyframes scanline { 0% { background-position: 0 0; } 100% { background-position: 0 100%; } }
        
        .app-window { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 1024px; height: 85vh; background-color: #0a0a0a; border: 1px solid #00ff00; z-index: 2000; box-shadow: 0 0 20px rgba(0, 255, 0, 0.2); flex-direction: column; }
        .app-title-bar { background-color: #001100; border-bottom: 1px solid #00ff00; padding: 5px 10px; display: flex; justify-content: space-between; align-items: center; cursor: move; color: #ff00ff; user-select: none; }
        .title-bar-buttons { display: flex; gap: 5px; }
        .title-bar-btn { border: 1px solid; cursor: pointer; width: 20px; height: 20px; text-align: center; line-height: 18px; font-family: monospace; font-weight: bold; }
        .minimize-btn { background-color: #ffff00; border-color: #ffff55; color: #001100; }
        .close-btn { background-color: #ff0000; border-color: #ff5555; color: #001100; }
        
        .app-content-iframe { flex-grow: 1; border: none; }

        #taskbar { display: flex; gap: 5px; position: fixed; bottom: 0; left: 0; width: 100%; background-color: #001100; border-top: 1px solid #00ff00; z-index: 3000; padding: 0 5px; }
        .taskbar-item { display: none; padding: 8px 15px; cursor: pointer; color: #00ff00; transition: background-color 0.2s; border: 1px solid #005500; margin: 3px 0; }
        .taskbar-item:hover { background-color: #003300; }

        #mobile-buttons { display: none; visibility: hidden; opacity: 0; transition: opacity 0.5s ease-in, bottom 0.3s ease-out; }

        @media (max-width: 768px) {
            body { padding-bottom: 45px; }
            .app-window { width: 100%; height: 100%; top: 0; left: 0; transform: none !important; border: none; }
            .app-title-bar { cursor: default; }

            /* **UPDATED:** Making BOTH title bar buttons visible and larger for mobile */
            .title-bar-btn {
                width: 30px;
                height: 30px;
                line-height: 28px;
            }

            #mobile-buttons { display: flex; position: fixed; bottom: 0; left: 0; width: 100%; background-color: #001100; border-top: 1px solid #00ff00; padding: 4px; justify-content: space-around; z-index: 4000; }
            #mobile-buttons button { background: transparent; border: 1px solid #00ff00; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px; padding: 5px 8px; margin: 2px; flex-grow: 1; text-align: center; }
        }
    </style>
</head>
<body>
    <div id="boot-screen">
        <div class="scanlines"></div>
        <div class="boot-message" style="animation-delay: 0.5s">> INITIATING MONADMELON BOOT SEQUENCE</div>
        <div class="boot-message" style="animation-delay: 1.2s">> LOADING KERNEL .................... [OK]</div>
        <div id="filesystem-mount-message" class="boot-message" style="animation-delay: 2.0s">> MOUNTING VIRTUAL FILESYSTEM ....... </div>
        <div class="boot-message" style="animation-delay: 2.8s">> INITIALIZING AUDIO SUBSYSTEM ....... [OK]</div>
        <div class="boot-message" style="animation-delay: 3.6s">> STARTING SUIKA DAEMON ............ </div>
        <div class="ascii-art-line" style="animation-delay: 4.0s">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó </div>
        <div class="ascii-art-line" style="animation-delay: 4.3s">‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó</div>
        <div class="ascii-art-line" style="animation-delay: 4.6s">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë</div>
        <div class="ascii-art-line" style="animation-delay: 4.9s">‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë</div>
        <div class="ascii-art-line" style="animation-delay: 5.2s">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë</div>
        <div class="ascii-art-line" style="animation-delay: 5.5s">‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù</div>
        <div class="boot-message" style="animation-delay: 6.0s">[OK]</div>
        <div class="boot-message" style="animation-delay: 6.5s">> SYSTEM READY</div>
        <div class="boot-message" style="animation-delay: 7.0s">> WELCOME TO MONADMELON</div>
    </div>

    <div id="terminal">
        <div class="output protected">a reflection of my mind. tech. philosophy. music.</div>
        <div class="output protected">type 'help' to begin</div>
        <br>
        <div id="output-container"></div>
        <div class="input-line">
            <span class="prompt" id="current-prompt">monadmelon@web:~$</span>
            <input type="text" id="input" autofocus autocapitalize="none" autocorrect="off">
        </div>
        <div id="scroll-anchor"></div>
    </div>

    <div id="audplayer-window" class="app-window">
        <div class="app-title-bar">
            <span>~/aud/audplayer</span>
            <div class="title-bar-buttons">
                <button class="title-bar-btn minimize-btn" onclick="minimizeAudPlayer()">-</button>
                <button class="title-bar-btn close-btn" onclick="closeAudPlayer()">X</button>
            </div>
        </div>
        <iframe id="audplayer-content" class="app-content-iframe" tabindex="-1"></iframe>
    </div>

    <div id="notes-app-window" class="app-window">
        <div class="app-title-bar">
            <span>~/app/notes</span>
            <div class="title-bar-buttons">
                <button class="title-bar-btn minimize-btn" onclick="minimizeNotesApp()">-</button>
                <button class="title-bar-btn close-btn" onclick="closeNotesApp()">X</button>
            </div>
        </div>
        <iframe id="notes-app-content" class="app-content-iframe" tabindex="-1"></iframe>
    </div>

    <div id="taskbar">
        <div id="audplayer-taskbar-item" class="taskbar-item" onclick="restoreAudPlayer()">[‚ô´ audplayer]</div>
        <div id="notes-app-taskbar-item" class="taskbar-item" onclick="restoreNotesApp()">[üìù notes]</div>
    </div>

    <div id="mobile-buttons">
        <button onclick="insertCommand('help', true)">help</button>
        <button onclick="insertCommand('audplayer', true)">audplayer</button>
        <button onclick="insertCommand('notes', true)">notes</button>
        <button onclick="insertCommand('clear', true)">clear</button>
    </div>

    <script>
        const terminal = document.getElementById('terminal');
        const input = document.getElementById('input');
        const outputContainer = document.getElementById('output-container');
        const scrollAnchor = document.getElementById('scroll-anchor');
        const currentPrompt = document.getElementById('current-prompt');
        const mobileButtons = document.getElementById('mobile-buttons');
        const taskbar = document.getElementById('taskbar');

        // App-specific elements
        const audplayerWindow = document.getElementById('audplayer-window');
        const audplayerContent = document.getElementById('audplayer-content');
        const audplayerTaskbarItem = document.getElementById('audplayer-taskbar-item');
        
        const notesAppWindow = document.getElementById('notes-app-window');
        const notesAppContent = document.getElementById('notes-app-content');
        const notesAppTaskbarItem = document.getElementById('notes-app-taskbar-item');
        
        let commandHistory = [], historyIndex = -1, currentDirectory = ['~'];
        let directoryStructure = {};

        // --- Generic App Window Dragging Logic ---
        function makeDraggable(windowElement) {
            const titleBar = windowElement.querySelector('.app-title-bar');
            let isDragging = false, offsetX, offsetY;

            titleBar.addEventListener('mousedown', (e) => {
                if (window.innerWidth <= 768 || e.target.classList.contains('title-bar-btn')) return;
                isDragging = true;
                offsetX = e.clientX - windowElement.offsetLeft;
                offsetY = e.clientY - windowElement.offsetTop;
                document.body.style.userSelect = 'none';
            });
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                windowElement.style.left = `${e.clientX - offsetX}px`;
                windowElement.style.top = `${e.clientY - offsetY}px`;
                windowElement.style.transform = 'none'; 
            });
            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.body.style.userSelect = '';
            });
        }
        makeDraggable(audplayerWindow);
        makeDraggable(notesAppWindow);

        // --- Mobile Command Button Helper ---
        function insertCommand(cmd, execute = false) {
            input.value = cmd;
            input.focus();
            if (execute) handleCommand();
        }

        // --- AudPlayer Window Management ---
        function launchAudPlayer() { terminal.style.display = 'none'; audplayerWindow.style.display = 'flex'; audplayerContent.src = './audplayer.html'; audplayerContent.focus(); }
        function closeAudPlayer() { audplayerWindow.style.display = 'none'; audplayerContent.src = 'about:blank'; audplayerTaskbarItem.style.display = 'none'; terminal.style.display = 'block'; mobileButtons.style.bottom = '0px'; input.focus(); }
        function minimizeAudPlayer() { audplayerWindow.style.display = 'none'; audplayerTaskbarItem.style.display = 'block'; terminal.style.display = 'block'; mobileButtons.style.bottom = `${taskbar.offsetHeight}px`; input.focus(); }
        function restoreAudPlayer() { audplayerTaskbarItem.style.display = 'none'; notesAppWindow.style.display = 'none'; notesAppTaskbarItem.style.display = 'none'; audplayerWindow.style.display = 'flex'; terminal.style.display = 'none'; mobileButtons.style.bottom = '0px'; audplayerContent.focus(); }
        
        // --- Notes App Window Management ---
        function launchNotesApp() { terminal.style.display = 'none'; notesAppWindow.style.display = 'flex'; notesAppContent.src = './notes.html'; notesAppContent.focus(); }
        function closeNotesApp() { notesAppWindow.style.display = 'none'; notesAppContent.src = 'about:blank'; notesAppTaskbarItem.style.display = 'none'; terminal.style.display = 'block'; mobileButtons.style.bottom = '0px'; input.focus(); }
        function minimizeNotesApp() { notesAppWindow.style.display = 'none'; notesAppTaskbarItem.style.display = 'block'; terminal.style.display = 'block'; mobileButtons.style.bottom = `${taskbar.offsetHeight}px`; input.focus(); }
        function restoreNotesApp() { notesAppTaskbarItem.style.display = 'none'; audplayerWindow.style.display = 'none'; audplayerTaskbarItem.style.display = 'none'; notesAppWindow.style.display = 'flex'; terminal.style.display = 'none'; mobileButtons.style.bottom = '0px'; notesAppContent.focus(); }
        
        // --- Terminal Commands ---
        const commands = {
            help: () => `available commands:\n    whoami, ls, cd, cat, pwd, clear, date, echo, audplayer, notes`,
            whoami: () => `i am a black cat named suika.`,
            ls: () => directoryStructure[getCurrentDirectory()]?.join('    ') || 'empty',
            cd: (args) => {
                if (!args[0]) return "cd: missing argument";
                const target = args[0];
                if (target === '~') { currentDirectory = ['~']; }
                else if (target === '..' || target === '../') { if (currentDirectory.length > 1) currentDirectory.pop(); }
                else {
                    const targetDir = target.endsWith('/') ? target : target + '/';
                    if (directoryStructure[getCurrentDirectory()]?.includes(targetDir)) { currentDirectory.push(targetDir); }
                    else { return `cd: ${target}: no such directory`; }
                }
                updatePrompt(); return '';
            },
            pwd: () => currentDirectory.join('/').replace(/\/\//g, '/'),
            cat: async (args) => {
                if (!args[0]) return "cat: missing argument";
                const filename = args[0];
                const currentDir = getCurrentDirectory();
                if (filename.endsWith('/')) return `cat: ${filename}: Is a directory`;
                if (!directoryStructure[currentDir]?.includes(filename)) return `cat: ${filename}: no such file`;
                let path = './content/';
                if (currentDir !== '~') path += currentDir;
                path += filename;
                try {
                    const response = await fetch(path);
                    if (!response.ok) return `cat: error fetching '${filename}'`;
                    return await response.text();
                } catch (error) { return `cat: network error fetching '${filename}'`; }
            },
            clear: () => { outputContainer.innerHTML = ''; return ''; },
            date: () => new Date().toLocaleString(),
            echo: (args) => args.join(' '),
            audplayer: () => { launchAudPlayer(); return ''; },
            notes: () => { launchNotesApp(); return ''; }
        };

        // --- Terminal Core Logic ---
        function getCurrentDirectory() { return currentDirectory[currentDirectory.length - 1]; }
        function updatePrompt() { const path = currentDirectory.join('/').replace(/\/\//g, '/'); currentPrompt.textContent = `monadmelon@web:${path}$`; }
        function addOutput(text, isCommand = false) { const output = document.createElement('div'); output.className = 'output'; if (isCommand) { output.innerHTML = `<span class="prompt">${currentPrompt.textContent} </span><span class="command">${text}</span>`; } else { output.textContent = text; } outputContainer.appendChild(output); scrollToBottom(); }
        async function handleCommand() { const fullCommand = input.value.trim(); if (!fullCommand) return; addOutput(fullCommand, true); const args = fullCommand.split(' '); const cmd = args[0].toLowerCase(); if (commands[cmd]) { const result = await commands[cmd](args.slice(1)); if (result) addOutput(result); } else { addOutput(`${cmd}: command not found.`); } commandHistory.push(fullCommand); historyIndex = commandHistory.length; input.value = ''; scrollToBottom(); }
        function scrollToBottom() { scrollAnchor.scrollIntoView(); }
        
        // --- Initialization ---
        async function initializeFileSystem() {
            const fsMountMessage = document.getElementById('filesystem-mount-message');
            try {
                const response = await fetch('./content/filesystem.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                directoryStructure = await response.json();
                fsMountMessage.innerHTML += '[OK]';
            } catch (error) {
                fsMountMessage.innerHTML += '<span style="color: #ff0000;">[FAILED]</span>';
                console.error("Failed to load filesystem:", error);
                directoryStructure = { '~': ['ERROR.txt'] };
            }
        }

        function initializeTerminal() {
            const bootScreen = document.getElementById('boot-screen');
            setTimeout(() => {
                if(bootScreen) {
                    bootScreen.style.opacity = 0;
                    setTimeout(() => {
                        bootScreen.style.display = 'none';
                        terminal.style.display = 'block';
                        mobileButtons.style.visibility = 'visible';
                        mobileButtons.style.opacity = 1;
                        input.focus();
                    }, 1000);
                }
            }, 8000);

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') { handleCommand(); }
                else if (e.key === 'ArrowUp') { 
                    e.preventDefault(); 
                    if (commandHistory.length > 0) { 
                        historyIndex = Math.max(0, historyIndex - 1); 
                        input.value = commandHistory[historyIndex] || ''; 
                    } 
                }
                else if (e.key === 'ArrowDown') { 
                    e.preventDefault(); 
                    historyIndex++; 
                    input.value = historyIndex < commandHistory.length ? commandHistory[historyIndex] : ''; 
                    if (historyIndex >= commandHistory.length) { 
                        historyIndex = commandHistory.length; 
                    } 
                }
            });
            terminal.addEventListener('click', () => input.focus());
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeFileSystem();
            initializeTerminal();
        });
    </script>
</body>
</html>