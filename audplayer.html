<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>audplayer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0a0a0a; color: #00ff00; font-family: 'Courier New', monospace; font-size: 14px; line-height: 1.4; padding: 15px; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        .main-content { display: flex; flex: 1; gap: 20px; overflow: hidden; }
        .terminal { flex: 1; background-color: #001100; border: 1px solid #00ff00; padding: 15px; overflow: hidden; position: relative; }
        .log-container { height: 100%; overflow-y: auto; }
        .terminal-line { margin-bottom: 8px; white-space: pre-wrap; color: #00bb00; }
        .log-header { color: #ff00ff; margin-bottom: 15px; }
        .log-message { color: #00ff00; }
        .visualizer-container { display: none; width: 100%; height: 100%; }
        #visualizer { width: 100%; height: 100%; }
        .player-section { width: 300px; display: flex; flex-direction: column; gap: 15px; }
        .player-box { background-color: #001100; border: 1px solid #00ff00; padding: 15px; }
        .now-playing { min-height: 80px; }
        .track-info { margin-bottom: 15px; }
        .track-title { color: #ff00ff; font-weight: bold; margin-bottom: 5px; word-wrap: break-word; }
        .progress-container { background-color: #002200; height: 10px; border: 1px solid #00ff00; margin-bottom: 10px; cursor: pointer; }
        .progress-bar { height: 100%; background-color: #00ff00; width: 0%; }
        .time-display { display: flex; justify-content: space-between; font-size: 12px; color: #008800; margin-bottom: 15px; }
        .controls { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .btn { background-color: #002200; color: #00ff00; border: 1px solid #00ff00; padding: 8px 12px; cursor: pointer; font-family: 'Courier New', monospace; transition: all 0.3s; }
        .btn:hover { background-color: #00ff00; color: #001100; }
        .volume-container { display: flex; align-items: center; gap: 10px; }
        .volume-slider { flex: 1; background: #002200; height: 6px; outline: none; -webkit-appearance: none; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; background: #00ff00; cursor: pointer; }
        .playlist { flex: 1; overflow-y: auto; }
        .playlist-title { color: #ff00ff; margin-bottom: 10px; font-size: 16px; }
        .track { padding: 10px; border-bottom: 1px dashed #008800; cursor: pointer; transition: all 0.3s; }
        .track:hover { background-color: #003300; }
        .track.playing { color: #ff00ff; background-color: #002200; }
        .options-section { margin-top: 15px; padding-top: 10px; border-top: 1px dashed #008800; font-size: 12px; color: #008800; }
        .option-toggle { cursor: pointer; }
        .option-toggle:hover { color: #ff00ff; }
    </style>
</head>
<body>
    <audio id="audio-player" crossorigin="anonymous"></audio>

    <div class="main-content">
        <div class="terminal">
            <div class="log-container" id="log-container">
                <div class="terminal-line log-header">[AUDPLAYER SYSTEM LOG]</div>
                <div class="terminal-line">Initialized successfully.</div>
                <div class="terminal-line">Awaiting playback command...</div>
                <div id="terminal-log"></div>
            </div>
            <div class="visualizer-container" id="visualizer-container">
                <canvas id="visualizer"></canvas>
            </div>
        </div>
        
        <div class="player-section">
            <div class="player-box now-playing">
                <div class="track-info">
                    <div class="track-title">--</div>
                    <div>monadmelon</div>
                </div>
                <div class="progress-container" id="progress-container"><div class="progress-bar" id="progress-bar"></div></div>
                <div class="time-display" id="time-display"><span>0:00</span><span>0:00</span></div>
                <div class="controls">
                    <button class="btn" id="prev-btn">⏮</button>
                    <button class="btn" id="play-btn">⏵</button>
                    <button class="btn" id="pause-btn" style="display:none;">⏸</button>
                    <button class="btn" id="next-btn">⏭</button>
                </div>
                <div class="volume-container">
                    <span>VOL:</span>
                    <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="70">
                </div>
            </div>
            
            <div class="player-box playlist">
                <div class="playlist-title">PLAYLIST [monadmelon.sounds]</div>
                <div id="playlist-container"></div>
                <div class="options-section">
                    <div>KEYBOARD CONTROLS:</div>
                    <div>Space - Play/Pause</div>
                    <div>→, ← - Next/Prev track</div>
                    <div>↑, ↓ - Volume up/down</div>
                    <div>V - Toggle Visualizer</div>
                    <br>
                    <div>OPTIONS:</div>
                    <div class="option-toggle" id="viz-toggle">Toggle Visualizer</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const audio = document.getElementById('audio-player');
            const canvas = document.getElementById('visualizer');
            const canvasCtx = canvas.getContext('2d');
            const logContainer = document.getElementById('log-container');
            const visualizerContainer = document.getElementById('visualizer-container');
            const vizToggleBtn = document.getElementById('viz-toggle');
            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const volumeSlider = document.getElementById('volume-slider');
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = document.getElementById('progress-container');
            const timeDisplay = document.getElementById('time-display');
            const trackTitleEl = document.querySelector('.track-title');
            const playlistContainer = document.getElementById('playlist-container');
            const terminalLog = document.getElementById('terminal-log');

            let audioContext, analyser, source;
            let visualizerEnabled = false;

            function setupAudioContext() {
                if (audioContext) return;
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                source = audioContext.createMediaElementSource(audio);
                analyser = audioContext.createAnalyser();
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                analyser.fftSize = 256;
            }

            function resizeCanvas() {
                canvas.width = visualizerContainer.clientWidth;
                canvas.height = visualizerContainer.clientHeight;
            }
            
            function drawVisualizer() {
                requestAnimationFrame(drawVisualizer);
                if (!visualizerEnabled || !analyser) return;

                const bufferLength = analyser.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);
                analyser.getByteFrequencyData(dataArray);

                canvasCtx.fillStyle = '#001100';
                canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
                const barWidth = (canvas.width / bufferLength) * 1.25;
                let x = 0;
                for (let i = 0; i < bufferLength; i++) {
                    const barHeight = dataArray[i] * (canvas.height / 255);
                    canvasCtx.fillStyle = `rgb(0, ${barHeight + 100}, 0)`;
                    canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                    x += barWidth + 1;
                }
            }

            function toggleVisualizer() {
                visualizerEnabled = !visualizerEnabled;
                if (visualizerEnabled) {
                    logContainer.style.display = 'none';
                    visualizerContainer.style.display = 'block';
                    resizeCanvas();
                } else {
                    logContainer.style.display = 'block';
                    visualizerContainer.style.display = 'none';
                }
            }
            
            const player = { playing: false, currentTrack: 0 };
            const tracks = [
                 { title: "Illusion of Control", path: "https://res.cloudinary.com/dolgrtzxe/video/upload/v1757808094/illusion_of_control_fj3ycm.mp3" },
                 { title: "源流をたどって", path: "https://res.cloudinary.com/dolgrtzxe/video/upload/v1757808101/%E6%BA%90%E6%B5%81%E3%82%92%E3%81%9F%E3%81%A9%E3%81%A3%E3%81%A6_pqghds.mp3" },
                 { title: "Reason to Live", path: "https://res.cloudinary.com/dolgrtzxe/video/upload/v1757815734/REASON_TO_LIVE_nscm6o.mp3"},
                 { title: "Reminiscence", path: "https://res.cloudinary.com/dolgrtzxe/video/upload/v1757815732/Reminiscence_nrj92d.mp3"},
                 { title: "Thelema", path: "https://res.cloudinary.com/dolgrtzxe/video/upload/v1757815731/Thelema_ztuvyu.mp3"}
            ];

            const formatTime = (seconds) => {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
            };
            const logToTerminal = (message) => {
                const logEntry = document.createElement('div');
                logEntry.className = 'terminal-line';
                logEntry.innerHTML = `<span class="log-message">${message}</span>`;
                terminalLog.prepend(logEntry);
            };
            const updatePlayerUI = () => {
                trackTitleEl.textContent = tracks[player.currentTrack].title;
                playBtn.style.display = player.playing ? 'none' : 'block';
                pauseBtn.style.display = player.playing ? 'block' : 'none';
                document.querySelectorAll('.track').forEach((trackEl, index) => {
                    trackEl.classList.toggle('playing', index === player.currentTrack);
                });
            };
            const selectTrack = (index) => {
                if (!audioContext) setupAudioContext();
                player.currentTrack = index;
                audio.src = tracks[player.currentTrack].path;
                audio.load();
                audio.play();
                logToTerminal(`Playing: ${tracks[player.currentTrack].title}`);
            };
            const togglePlay = () => {
                if (!audio.src) { selectTrack(0); return; }
                if (audioContext.state === 'suspended') audioContext.resume();
                audio.paused ? audio.play() : audio.pause();
            };
            const nextTrack = () => selectTrack((player.currentTrack + 1) % tracks.length);
            const prevTrack = () => selectTrack((player.currentTrack - 1 + tracks.length) % tracks.length);
            const changeVolume = () => audio.volume = volumeSlider.value / 100;
            const seek = (e) => {
                const width = progressContainer.clientWidth;
                const clickX = e.offsetX;
                audio.currentTime = (clickX / width) * audio.duration;
            };
            const buildPlaylist = () => {
                tracks.forEach((track, index) => {
                    const trackEl = document.createElement('div');
                    trackEl.className = 'track';
                    trackEl.textContent = `${index + 1}. ${track.title}`;
                    trackEl.addEventListener('click', () => selectTrack(index));
                    playlistContainer.appendChild(trackEl);
                });
            };

            vizToggleBtn.addEventListener('click', toggleVisualizer);
            playBtn.addEventListener('click', togglePlay);
            pauseBtn.addEventListener('click', togglePlay);
            nextBtn.addEventListener('click', nextTrack);
            prevBtn.addEventListener('click', prevTrack);
            volumeSlider.addEventListener('input', changeVolume);
            progressContainer.addEventListener('click', seek);
            audio.addEventListener('play', () => { player.playing = true; updatePlayerUI(); });
            audio.addEventListener('pause', () => { player.playing = false; updatePlayerUI(); });
            audio.addEventListener('timeupdate', () => { if (!isNaN(audio.duration)) { progressBar.style.width = `${(audio.currentTime / audio.duration) * 100}%`; timeDisplay.children[0].textContent = formatTime(audio.currentTime); } });
            audio.addEventListener('loadedmetadata', () => { timeDisplay.children[1].textContent = formatTime(audio.duration); });
            audio.addEventListener('ended', nextTrack);
            
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;
                switch (e.key) {
                    case ' ': e.preventDefault(); togglePlay(); break;
                    case 'ArrowRight': e.preventDefault(); nextTrack(); break;
                    case 'ArrowLeft': e.preventDefault(); prevTrack(); break;
                    case 'ArrowUp': e.preventDefault(); volumeSlider.value = Math.min(100, parseInt(volumeSlider.value) + 5); changeVolume(); break;
                    case 'ArrowDown': e.preventDefault(); volumeSlider.value = Math.max(0, parseInt(volumeSlider.value) - 5); changeVolume(); break;
                    case 'v':
                    case 'V':
                        e.preventDefault();
                        toggleVisualizer();
                        break;
                }
            });

            window.addEventListener('resize', () => { if (visualizerEnabled) resizeCanvas(); });

            buildPlaylist();
            updatePlayerUI();
            changeVolume();
            drawVisualizer();
        });
    </script>
</body>
</html>